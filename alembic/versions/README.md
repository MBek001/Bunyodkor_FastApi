# Alembic Migrations

This directory contains database migration files generated by Alembic.

## Creating a New Migration

To create a new migration after changing models:

```bash
# Auto-generate migration based on model changes
alembic revision --autogenerate -m "description of changes"

# Apply migrations
alembic upgrade head

# Rollback last migration
alembic downgrade -1
```

## Important Notes

- **DO NOT** manually create migration files
- Always use `alembic revision --autogenerate` to create migrations
- Review auto-generated migrations before applying them
- Test migrations in development before applying to production

## Current Migrations

Migrations are automatically detected and listed by Alembic.
Use `alembic history` to see all migrations.

## Partial Unique Index for Groups

For the `groups.identifier` field, we need a partial unique index that only enforces uniqueness for non-DELETED groups.

After running `alembic revision --autogenerate`, you may need to manually modify the generated migration to add:

```python
# In upgrade():
op.execute("""
    CREATE UNIQUE INDEX ix_groups_identifier_active
    ON groups (identifier)
    WHERE status != 'DELETED'
""")

# In downgrade():
op.drop_index('ix_groups_identifier_active', table_name='groups', if_exists=True)
```

This allows DELETED group identifiers to be reused for new groups.
